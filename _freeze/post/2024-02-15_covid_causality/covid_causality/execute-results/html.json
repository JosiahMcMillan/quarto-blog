{
  "hash": "ea25045915fff65f7e4b0aad9efacbb3",
  "result": {
    "markdown": "---\ntitle: \"We don't know if Covid ages us epigenetically\"\nsubtitle: | \n  How selection bias rules everything around us\ndate: \"2024-02-15\"\ncategories: [covid, selection, bias, simulation]\neditor: visual\ndf_print: tibble\nformat: html\n---\n\n<!-- ---\ntitle: \"Casually Claiming Covid Causality is Not Reflective of Reality\"\neditor: visual\ndf_print: tibble\nformat: html\n--- -->\n\nIn the following post I will be exploring the sometimes claimed effect of Covid-19 hospitalization on epigenetic aging. The core aim of this writing is to show that causal or experimental methods are required to determining if this claim is true or not and current research is insufficient for this task.\n\n* I provide some minor background on the studies that incited this post, including some of the effects they could control and some details that caution against the current online interpretation of them.\n\n* I generate data without explicitly modelling an effect from Covid-19 keeping in mind semi-realistic distributions of age, gender, and underlying health. \n\n* Explore and analyze the simulated data to determine if we can discover a false effect of Covid-19 hospitalization on our measure of underlying health given two rates of hospitalization dependent on underlying health.\n\n\n# Introduction\n\nRecently I saw a [Tweet](https://archive.is/DCMaI) that made an interesting claim: that Covid-19 aged people, I looked in the replies and found that there were tables claiming that babies were aged 35 years by a Covid-19 *infection*. I got curious and looked deeper into the cited studies and found that this and many tweets like it have made causal claims where they shouldn't have. The claim is that getting infected with Covid-19 leads to epigenetic aging, however [the paper](https://pubmed.ncbi.nlm.nih.gov/35440567/) only deals with hospitalized patients so some authors are already exaggerating the scope of this potential problem. Setting that aside I thought this would be a good demonstration of how the old cliche of correlation does not equal causation should still be kept in mind and how we should be hesitant to accept causal framings without seeing the modelling framework used by study authors.\n\nTo be clear I am not going to make the argument here that there isn't an effect of Covid-19 on epigenetic aging factors, however I am going to provide an insight into why we cannot interpret the linked study causally (as even the authors write!). There are other factors that increase susceptibility to hospitalization from Covid-19 such as asthma, obesity, or advanced age.\n\nIn order to demonstrate how an underlying susceptibility to Covid-19 may explain the differential epigenetic age between those who were hospitalized and those who were not in the cited study I will simulate some data using some stylized facts about health over a human lifespan that we can then use to model a population.\n\nOf note, while the data for the Covid-19 infected patients used by the study excluded individuals for the following risk factors:\n\n[**\"[...] obesity with a BMI â‰¥ 30, diabetes, hypertension, autoimmune disorders, and chronic cardiovascular or lung diseases), smoking habit or advanced age (> 61 years).\"**](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8047083/)\n\nThe set of risk factors for getting hospitalized with Covid-19 not covered by this exclusion are quite large. Additionally, the use of a hard cutoff for obesity is also likely to cause trouble, there is no special property of a BMI of 30 that leads to increased death versus a BMI of 29. Realistically, it is very hard to exclude everything that could muck about with our data, that is normal and a consequence of a real world which is messy. This is part of my belief that this study is probably insufficient for determining Covid-19 epigenetic aging increases in addition to the fact that non-causal methods were used.\n\nAnother study cited in the same vein of research but with similar limitations is [this one](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8201243/) where a similar set of modelling restrictions exist. Of note:\n\n**\"The two groups considered in this study were not significantly different in terms of age, sex, and known clinical conditions before SARS-CoV-2 infection, except for a relatively higher incidence of BMI > 30 (15.3% vs. 9%) in the post-COVID-19 population compared with controls, as well as a record of more frequent lung diseases (20.2% vs. 1.6%; see Table 1).\"**\n\nA record of more frequent lung diseases and a higher incidence of obesity are both going to be impediments in determining the true effect of Covid-19 on these measures of epigenetic age versus the effect of lung disease and obesity.\n\nTo put it succinctly, the argument I am putting forward here is that there is a possible reverse relationship that could be happening here. Whereas the current belief of some may be that Covid-19 hospitalization has some effect on epigenetic aging (modeled here by health scores) we can find the same effect from using the fact that people with poorer health are more likely to be hospitalized from Covid-19 without modelling the effect of Covid-19 on epigenetic aging at all. \n\n\n\n::: {.cell}\n\n:::\n\n\n\n# Simulation Setup\nIn order to make sure that our simulation fits some of the stylized facts of the Covid Crisis, I wanted to ensure the population we generated was loosely similar to the real population in terms of gender and age, the exact distribution of age doesn't really matter too much for our effect as we use stratified sampling later on to get equal groups from each age group (of 10 years). The gender parameter is generated with a 50/50 distribution between male and female, reflecting the general gender distribution in the population.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Generate Gender (1 = Male, 0 = Female)\ngender <- sample(c(0, 1), n, replace = TRUE, prob = c(0.5, 0.5))\n```\n:::\n\n\nAge is generated with a normal distribution, centered around 50 years with a standard deviation of 15, capturing a broad age range representative of the population. Negative ages are corrected, ensuring realism in the data.  \n\nHealth scores are generated with a normal distribution, centered around 75 with a standard deviation of 10. This represents a baseline health status for individuals in the simulation.\nThe negative correlation between age and health score mirrors the observation that older individuals tend to have poorer health outcomes in general but especially when infected with COVID-19. A stronger additive effect was also included for individuals over the age of 70 to reflect the [elevated risk](https://www.cdc.gov/mmwr/volumes/72/wr/mm7240a3.htm) that comes with advanced age.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Generate Age (assuming a somewhat realistic distribution)\nage <- round(rnorm(n, mean = 50, sd = 15))\nage[age < 0] <- 0  # Correcting for any negative ages due to randomness\n\n# Generate normally distributed health scores\nhealth_scores <- rnorm(n, mean = 75, sd = 10)\n\nbase_age_effect <- -0.2  # Base effect for those under 70\nadditional_effect_over_70 <- -0.5  # Additional negative effect for those over 70\n\n# Apply the age effect\nhealth_scores <- ifelse(age <= 70,\n                        health_scores + (base_age_effect * (age)),\n                        health_scores + ((base_age_effect + additional_effect_over_70) *(age)))\n\n# Ensure health scores do not go below a minimum threshold, if necessary\n# For example, if health scores should not be negative:\nhealth_scores[health_scores < 0] <- 0\n# Create a data frame\nsynthetic_data <- data.frame(gender, age, health_scores)\n```\n:::\n\n\nHospitalization likelihood is determined based on the health score, with a threshold set at 50.\nIndividuals with health scores below the threshold have a higher chance of hospitalization (80%), reflecting the increased risk of severe outcomes for individuals with poorer health.\nIndividuals with health scores at or above the threshold have a lower chance of hospitalization (5%), representing the lower risk of severe outcomes for healthier individuals.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhospitalization_threshold <- 50\nhospitalization_chance_high <- 0.8  # Chance of hospitalization if health score is under 50\nhospitalization_chance_low <- 0.05   # Chance of hospitalization if health score is 50 or above\n\n# Generate hospitalization status based on health score\nsynthetic_data$hospitalized <- ifelse(synthetic_data$health_scores < hospitalization_threshold,\n                                      rbinom(n, 1, hospitalization_chance_high),\n                                      rbinom(n, 1, hospitalization_chance_low))\n\n# Check the hospitalization rate by health score condition\ntable(synthetic_data$hospitalized, synthetic_data$health_scores < hospitalization_threshold)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   \n    FALSE  TRUE\n  0 80902  2865\n  1  4308 11925\n```\n:::\n:::\n\n\n\n## Data Grouping\nWe filter out the edge cases here and add some age group breaks to make it such that there are groups we can then use to see how much the implied age of a person is increased from Covid-19 infection. I also use this time to display the age and hospitalization table results, we can see a fairly strong age effect where the oldest groups even have more individuals hospitalized than not.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsynthetic_data <- synthetic_data %>%\n  filter(age <= 90) %>% filter(age > 10)\n\n# Define the breaks for the groups, extending the upper limit to cover all ages above 100\nbreaks <- seq(10, 90, by = 10)\n\n# Ensure breaks are unique and in ascending order\nbreaks <- unique(sort(breaks))\n\n# Define the labels for the groups\nlabels <- c(\"10-20\", \"20-30\", \"30-40\", \"40-50\", \"50-60\", \"60-70\", \"70-80\", \"80-90\")\n\n# Group the variable\nsynthetic_data <- synthetic_data %>%\n  mutate(age_group = cut(age, breaks = breaks, labels = labels))\n\n# Create a contingency table of hospitalization by age group\nhospitalization_by_age_group <- table(synthetic_data$hospitalized, synthetic_data$age_group)\n\n# Print the table\nhospitalization_by_age_group\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   \n    10-20 20-30 30-40 40-50 50-60 60-70 70-80 80-90\n  0  1870  6637 15141 22896 21688 13389  1328   327\n  1   126   519  1339  2379  2724  2098  5261  1487\n```\n:::\n:::\n\n\nWe repeat the above procedure but instead we group by health scores so further visualizations are improved.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate the maximum value of health_scores\nmax_health_scores <- max(synthetic_data$health_scores)\n\n# Calculate the maximum value for the breaks (nearest multiple of 10 above max_health_scores)\nmax_breaks <- ceiling(max_health_scores / 10) * 10\n\nbreaks <- seq(0, max(synthetic_data$health_scores), by = 10)  # Extend to cover the maximum value\n\n# Add an additional break at the end\nbreaks <- c(breaks, max_breaks + 10)\n\n# Group the variable\nsynthetic_data <- synthetic_data %>%\n  mutate(health_groups = cut(health_scores, breaks = breaks, labels = c(\"0-10\", \"10-20\", \"20-30\", \"30-40\", \"40-50\", \"50-60\", \"60-70\", \"70-80\", \"80-90\", \"90-100\", \"100-110\", \"110+\")))\n\nsynthetic_data <- na.omit(synthetic_data)\n\n\nhospitalized <- synthetic_data[(synthetic_data$hospitalized == 1), ]\nnonhospitalized <- synthetic_data[(synthetic_data$hospitalized == 0), ]\n```\n:::\n\n\n## Sampling\nFinally I observed that there were similar distributions of age in the real data so in order to construct our sample to be similar we use stratified sampling to get equal groups of 50 for each age group in our synthetic data. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(hospitalized$age_group)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n10-20 20-30 30-40 40-50 50-60 60-70 70-80 80-90 \n  126   519  1339  2379  2724  2098  5202  1390 \n```\n:::\n\n```{.r .cell-code}\ntable(nonhospitalized$age_group)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n10-20 20-30 30-40 40-50 50-60 60-70 70-80 80-90 \n 1870  6637 15141 22896 21688 13389  1314   311 \n```\n:::\n\n```{.r .cell-code}\nstrata_sizes <- rep(50, length(unique(synthetic_data$age_group)))\n\n# Perform stratified sampling\nstrata_sample_hosp <- strata(data = hospitalized, \n                        stratanames = c(\"age_group\"), \n                        size = strata_sizes, \n                        method = \"srswor\")\n\nstrata_sample_nonhosp <- strata(data = nonhospitalized, \n                        stratanames = c(\"age_group\"), \n                        size = strata_sizes, \n                        method = \"srswor\")\n\nsampled_data_hosp <- getdata(hospitalized, strata_sample_hosp)\nsampled_data_nonhosp <- getdata(nonhospitalized, strata_sample_nonhosp)\n```\n:::\n\n\n# \"Effect of Hospitalization\" on health scores\nBelow we can see the frequency of membership into different groupings of health_scores, the grouping for hospitalized with the highest membership is the 40-50 group. The health scores of the hospitalized group are lower on average as well. Some of this boundary effect is because the health score cutoff for a higher probability of getting hospitalized is 50 so this behavior is expected.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhealth_groups_nonhosp <- as.data.frame(table(sampled_data_nonhosp$health_groups))\nhealth_groups_hosp <- as.data.frame(table(sampled_data_hosp$health_groups))\n\nbarplot(health_groups_hosp$Freq, names.arg = health_groups_hosp$Var1, xlab = \"Health Groups\", ylab = \"Frequency\", col = rgb(0,0,1,0.5), main = \"Histogram of Health Groups\", ylim = c(0, max(health_groups_hosp$Freq, health_groups_nonhosp$Freq) + 10))\n\nbarplot(health_groups_nonhosp$Freq, names.arg = health_groups_nonhosp$Var1, col = rgb(1,0,0,0.5), add = TRUE)\n\n# Add a legend\nlegend(\"topright\", legend = c(\"freq hospitalized\", \"freq nonhospitalized\"), fill = c(\"blue\", \"red\"))\n```\n\n::: {.cell-output-display}\n![](covid_causality_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\nWe can even construct the (unsourced as far as I could tell when looking through the linked paper and supplementary tables) [image shared](https://archive.is/raleL) by some using our data! The results are not as granular (I use 10 year groups rather than 5) but we can get a similar table with our data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\naverage_health_by_age <- aggregate(health_scores ~ age_group, data = sampled_data_hosp, FUN = mean)\n# average_health_by_age\n\naverage_health_by_age_non <- aggregate(health_scores ~ age_group, data = sampled_data_nonhosp, FUN = mean)\n# average_health_by_age_non\n\nhealth_score_averages <- dplyr::left_join(average_health_by_age, average_health_by_age_non, by = \"age_group\")\n\nhealth_score_averages$diff <- health_score_averages$health_scores.y - health_score_averages$health_scores.x\n\nhealth_score_averages <- health_score_averages %>%\n  rename(hospitalized_health_score = health_scores.x,\n         non_hospitalized_health_score  = health_scores.y)\n\nhealth_score_averages$hospitalized_health_score <- round(health_score_averages$hospitalized_health_score)\n\nhealth_score_averages$non_hospitalized_health_score <- round(health_score_averages$non_hospitalized_health_score)\n\nhealth_score_averages$diff <- round(abs(health_score_averages$hospitalized_health_score - health_score_averages$non_hospitalized_health_score))\n\nconvert_to_average_age <- function(age_range) {\n  age_split <- as.numeric(strsplit(as.character(age_range), \"-\")[[1]])\n  return(mean(age_split))\n}\n\n# Function to find the closest age group\nfind_closest_age_group <- function(score) {\n  # Calculate the absolute difference\n  health_score_averages$score_diff <- abs(health_score_averages$non_hospitalized_health_score - score)\n  # Find the row with the minimum difference\n  closest <- health_score_averages[which.min(health_score_averages$score_diff), ]\n  return(closest$age_group)\n}\n\n# Apply the function for each hospitalized health score\nhealth_score_averages$matched_age_group <- sapply(health_score_averages$hospitalized_health_score, find_closest_age_group)\n\nhealth_score_averages$chronological_age <- sapply(health_score_averages$age_group, convert_to_average_age)\nhealth_score_averages$matched_age_group <- sapply(health_score_averages$matched_age_group, convert_to_average_age)\n\nhealth_score_averages <- health_score_averages %>%\n  rename(covid_affected_age  = matched_age_group)\n\nhealth_score_averages$diff <- health_score_averages$covid_affected_age - health_score_averages$chronological_age\n\nprint(health_score_averages[, c('chronological_age', 'covid_affected_age', 'diff')])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  chronological_age covid_affected_age diff\n1                15                 45   30\n2                25                 45   20\n3                35                 65   30\n4                45                 65   20\n5                55                 65   10\n6                65                 65    0\n7                75                 75    0\n8                85                 85    0\n```\n:::\n:::\n\n\n\nWe can see here the relationship between health scores, age, and hospitalization. Hospitalization is associated with a lower average health score, age as well, and the interaction between the two factors actually appears to diminish over time, as the distance between the two lines of best fit decreases as age increases. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ncombined_data <- rbind(sampled_data_hosp, sampled_data_nonhosp)\n\n\n# Create a scatter plot\nplot(combined_data$age, combined_data$health_scores, \n     xlab = \"Age\", ylab = \"Health Scores\", \n     main = \"Effect of Hospitalization on Health Scores by Age\",\n     pch = 19, col = ifelse(combined_data$hospitalized == 1, \"red\", \"blue\"))\n\n# Add a legend\nlegend(\"topleft\", legend = c(\"Non-hospitalized\", \"Hospitalized\"),\n       col = c(\"blue\", \"red\"), pch = 19)\n\n# Fit a linear regression line for each group\nabline(lm(health_scores ~ age, data = combined_data[combined_data$hospitalized == 0,]), col = \"blue\")\nabline(lm(health_scores ~ age, data = combined_data[combined_data$hospitalized == 1,]), col = \"red\")\n```\n\n::: {.cell-output-display}\n![](covid_causality_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nWe see the same difference in our age groupings, the hospitalized among all age groups have lower health scores.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(health_score_averages, aes(x = age_group)) +\n  geom_bar(aes(y = hospitalized_health_score), stat = \"identity\", fill = \"lightblue\", alpha = 0.5) +\n  geom_errorbar(aes(ymin = hospitalized_health_score, ymax = non_hospitalized_health_score), width = 0.2) +\n  geom_bar(aes(y = non_hospitalized_health_score), stat = \"identity\", fill = \"lightgreen\", alpha = 0.5) +\n  labs(title = \"Health Scores by Age Group\",\n       y = \"Health Scores\",\n       x = \"Age Group\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](covid_causality_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nAnd look! The differences between the health scores in the hospitalized and non hospitalized were found to be statistically significant\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt_test_result <- t.test(sampled_data_hosp$health_scores, sampled_data_nonhosp$health_scores)\nt_test_result\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tWelch Two Sample t-test\n\ndata:  sampled_data_hosp$health_scores and sampled_data_nonhosp$health_scores\nt = -4.585, df = 789.19, p-value = 5.278e-06\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n -9.985862 -3.998642\nsample estimates:\nmean of x mean of y \n 49.18876  56.18101 \n```\n:::\n:::\n\n\n\n# Conclusion\nOur study designs a scenario that sidesteps modeling COVID-19's direct biological effects on epigenetic aging, focusing instead on how pre-existing health conditions influence hospitalization rates. This approach sheds light on the potential for selection bias to simulate a 'COVID effect' on aging metrics, positing that poorer health could lead to higher hospitalization rates, thus skewing epigenetic aging data. By excluding the virus's direct biological impact from our model, we aim to show that health disparities may account for the observed variations in aging among hospitalized versus non-hospitalized groups. This emphasizes the need to distinguish correlation from causation in attributing changes in epigenetic aging to COVID-19, cautioning against conflating virus effects with the pre-existing health conditions of those most at risk. \n\nOverall we need additional information (as the authors themselves write), we shouldn't draw conclusions about the effect of Covid-19 on epigenetic aging without using a different modelling strategy that is causal. \n\n\n\n\n\n",
    "supporting": [
      "covid_causality_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}